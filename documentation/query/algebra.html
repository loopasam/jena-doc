<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<!--

    Licensed to the Apache Software Foundation (ASF) under one or more
    contributor license agreements.  See the NOTICE file distributed with
    this work for additional information regarding copyright ownership.
    The ASF licenses this file to You under the Apache License, Version 2.0
    (the "License"); you may not use this file except in compliance with
    the License.  You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE- 2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
-->

  <link href="/jena-doc/css/bootstrap.css" rel="stylesheet" type="text/css">
  <link href="/jena-doc/css/bootstrap-extension.css" rel="stylesheet" type="text/css">

  <title>Apache Jena - ARQ - SPARQL Algebra</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>
  <script src="/js/jena-navigation.js" type="text/javascript"></script>
  <script src="/js/bootstrap.min.js"></script>
</head>

<body>
    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
        <a class="brand" href="/jena-doc/index.html" style="padding-top: 6px; padding-bottom: 0px;">
            <img class="logo-menu" src="/images/jena-logo/jena-logo-notext-small.png">
          </a>
          <a class="brand" href="/jena-doc/index.html">Apache Jena</a>
          <div class="nav-collapse collapse">
            <ul class="nav">
              <li id="homepage"><a href="/jena-doc/index.html"><i class="icon-home"></i> Home</a></li>
              <li id="download"><a href="/jena-doc/download/index.html"><i class="icon-download-alt"></i> Download</a></li>
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="icon-book"></i> Learn <b class="caret"></b></a>
                <ul class="dropdown-menu">
                  <li class="nav-header">Tutorials</li>
                  <li><a href="/jena-doc/tutorials/rdf_api.html">RDF core API tutorial</a></li>
                  <li><a href="/jena-doc/tutorials/sparql.html">SPARQL tutorial</a></li>
                  <li><a href="/jena-doc/documentation/query/manipulating_sparql_using_arq.html">Manipulating SPARQL using ARQ</a></li>
                  <li><a href="/jena-doc/tutorials/using_jena_with_eclipse.html">Using Jena with Eclipse</a></li>
                  <li><a href="/jena-doc/documentation/notes/index.html">Recipes</a></li>
                  <li class="divider"></li>
                  <li class="nav-header">Reference</li>
                  <li><a href="/jena-doc/documentation/index.html">Overview</a></li>
                  <li><a href="/jena-doc/documentation/javadoc/">Javadoc</a></li>
                  <li><a href="/jena-doc/documentation/tools/index.html">Command-line tools</a></li>
                  <li><a href="/jena-doc/documentation/rdf/index.html">RDF API</a></li>
                  <li><a href="/jena-doc/documentation/query/index.html">ARQ (SPARQL)</a></li>
                  <li><a href="/jena-doc/documentation/serving_data/index.html">Fuseki</a></li>
                  <li><a href="/jena-doc/documentation/tdb/index.html">TDB</a></li>
                  <li><a href="/jena-doc/documentation/assembler/index.html">Assembler</a></li>
                  <li><a href="/jena-doc/documentation/sdb/index.html">SDB</a></li>
                  <li><a href="/jena-doc/documentation/ontology/">Ontology API</a></li>
                  <li><a href="/jena-doc/documentation/inference/index.html">Inference API</a></li>
                </ul>
              </li>
              <li id="ask"><a href="/jena-doc/help_and_support/index.html"><i class="icon-question-sign"></i> Ask</a></li>
              
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="icon-bullhorn"></i> Get involved <b class="caret"></b></a>
                <ul class="dropdown-menu">
                  <li><a href="/jena-doc/getting_involved/index.html">Contribute</a></li>
                  <li><a href="/jena-doc/help_and_support/bugs_and_suggestions.html">Report a bug</a></li>
                  <li class="divider"></li>
                  <li class="nav-header">Project</li>
                  <li><a href="/jena-doc/about_jena/about.html">About Jena</a></li>
                  <li><a href="/jena-doc/about_jena/roadmap.html">Roadmap</a></li>
                  <li><a href="/jena-doc/about_jena/architecture.html">Architecture</a></li>
                  <li><a href="/jena-doc/about_jena/team.html">Project team</a></li>
                  <li><a href="/jena-doc/about_jena/contributions.html">Related projects</a></li>
                  <li class="divider"></li>
                  <li class="nav-header">ASF</li>
                  <li><a href="http://www.apache.org/">Apache Software Foundation</a></li>
                  <li><a href="http://www.apache.org/licenses/LICENSE-2.0">License</a></li>
                  <li><a href="http://www.apache.org/foundation/thanks.html">Thanks</a></li>
                  <li><a href="http://www.apache.org/foundation/sponsorship.html">Become a Sponsor</a></li>
                  <li><a href="http://www.apache.org/security/">Security</a></li>
                </ul>
              </li>
            </ul>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>


<div class="container">
	<div class="row-fluid">
	<div class="span12">
	<h1 class="title">ARQ - SPARQL Algebra</h1>
  <p>A SPARQL query in ARQ goes through several stages of processing:</p>
<ul>
<li>String to Query (parsing)</li>
<li>Translation from Query to a SPARQL algebra expression</li>
<li>Optimization of the algebra expression</li>
<li>Query plan determination and low-level optimization</li>
<li>Evaluation of the query plan</li>
</ul>
<p>This page describes how to access and use expressions in the SPARQL
algebra within ARQ. The definition of the SPARQL algebra is to be
found in the SPARQL specification in
<a href="http://www.w3.org/TR/sparql11-query/#sparqlDefinition">section 12</a>.
<a href="arq-query-eval.html">ARQ can be extended</a> to modify the evaluation
of the algebra form to access difefrent graph storage
implementations.</p>
<p>The classes for the datastructures for the algebra resize in the
package <code>com.hp.hpl.jena.sparql.algebra</code> in the <code>op</code> subpackage. 
All the classes are names "<code>Op...</code>"; the interface that they all
offer is "<code>Op</code>".</p>
<h2 id="viewing-the-algebra-expression-for-a-query">Viewing the algebra expression for a Query</h2>
<p>The command line tool <a href="cmds.html#arq.qparse">arq.qparse</a> will print
the algebra form of a query:</p>
<div class="codehilite"><pre><span class="n">arq</span><span class="p">.</span><span class="n">qparse</span> <span class="o">--</span><span class="n">print</span><span class="o">=</span><span class="n">op</span> <span class="o">--</span><span class="n">query</span><span class="o">=</span><span class="n">Q</span><span class="p">.</span><span class="n">rq</span>
<span class="n">arq</span><span class="p">.</span><span class="n">qparse</span> <span class="o">--</span><span class="n">print</span><span class="o">=</span><span class="n">op</span> <span class="err">&#39;</span><span class="n">SELECT</span> <span class="o">*</span> <span class="p">{</span> <span class="o">?</span><span class="n">s</span> <span class="o">?</span><span class="n">p</span> <span class="o">?</span><span class="n">o</span><span class="p">}</span><span class="err">&#39;</span>
</pre></div>


<p>The syntax of the output is <a href="../notes/sse.html">SSE</a>, a
simple format for writing data structures involving RDF terms. It
can be read back in again to produce the Java form of the algebra
expression.</p>
<h2 id="turning-a-query-into-an-algebra-expression">Turning a query into an algebra expression</h2>
<p>Getting the algebra expression for a Query is simply a matter of
passing the parsed Query object to the transaction function in the
<code>Algebra</code> class:</p>
<div class="codehilite"><pre><span class="n">Query</span> <span class="n">query</span> <span class="o">=</span> <span class="n">QueryFactory</span><span class="p">.</span><span class="n">create</span><span class="p">(.....)</span> <span class="p">;</span>
<span class="n">Op</span> <span class="n">op</span> <span class="o">=</span> <span class="n">Algebra</span><span class="p">.</span><span class="n">compile</span><span class="p">(</span><span class="n">query</span><span class="p">)</span> <span class="p">;</span>
</pre></div>


<p>And back again.</p>
<div class="codehilite"><pre><span class="n">Query</span> <span class="n">query</span> <span class="o">=</span> <span class="n">OpAsQuery</span><span class="p">.</span><span class="n">asQuery</span><span class="p">(</span><span class="n">op</span><span class="p">)</span> <span class="p">;</span>
<span class="n">System</span><span class="p">.</span><span class="n">out</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">query</span><span class="p">.</span><span class="n">serialize</span><span class="p">())</span> <span class="p">;</span>
</pre></div>


<p>This reverse translation can handle any algebra expression
originally from a SPARQL Query, but not any algebra expression.  It
is possible to create programmatically useful algebra expressions
that can not be truned into a query, especially if they involve
algebra.  Also, the query produced may not be exactly the same but
will yield the same results (for example, filters may be moved
because the SPARQL query algebra translation in the SPARQL
specification moves filter expressions around).</p>
<h2 id="directly-reading-and-writing-algebra-expression">Directly reading and writing algebra expression</h2>
<p>The SSE class is a collection of functions to parse SSE expressions
for the SPARQ algebra but also RDF terms, filter expressions and
even dataset and graphs.</p>
<div class="codehilite"><pre><span class="n">Op</span> <span class="n">op</span> <span class="o">=</span> <span class="n">SSE</span><span class="p">.</span><span class="n">parseOp</span><span class="p">(</span><span class="s">&quot;(bgp (?s ?p ?o))&quot;</span><span class="p">)</span> <span class="p">;</span>    <span class="c1">// Read a string</span>

<span class="n">Op</span> <span class="n">op</span> <span class="o">=</span> <span class="n">SSE</span><span class="p">.</span><span class="n">readOp</span><span class="p">(</span><span class="s">&quot;filename.sse&quot;</span><span class="p">)</span> <span class="p">;</span>     <span class="c1">// Read a file</span>
</pre></div>


<p>The SSE class simply calls the appropriate builder operation from
the <code>com.hp.hpl.jena.sparql.sse.builder</code> package.</p>
<p>To go with this, there is a collection of writers for many of the
Java structures in ARQ. </p>
<div class="codehilite"><pre><span class="n">Op</span> <span class="n">op</span> <span class="o">=</span> <span class="p">...</span> <span class="p">;</span>
<span class="n">SE</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">op</span><span class="p">)</span> <span class="p">;</span>      <span class="c1">// Write to stdout</span>
</pre></div>


<p>Writers default to writing to <code>System.out</code> but support calls to any
output stream (it manages the conversion to UTF-8) and ARQ own
<code>IndentedWriter</code>s form for embedding in structured output.  Again,
SSE is simply passing the calls to the writer operation from the
<code>com.hp.hpl.jena.sparql.sse.writer</code> package.</p>
<h2 id="creating-an-algebra-expression-programmatically">Creating an algebra expression programmatically</h2>
<p>See the example in <code>src-examples/arq.examples.AlgebraExec</code>.</p>
<p>To produce the complete javadoc for ARQ, download an ARQ
distribution and run the ant task 'javadoc-all'.</p>
<h2 id="evaluating-a-algebra-expression">Evaluating a algebra expression</h2>
<p>See the example in <code>src-examples/arq.examples.AlgebraExec</code>.</p>
<div class="codehilite"><pre><span class="n">QueryIterator</span> <span class="n">qIter</span> <span class="o">=</span> <span class="n">Algebra</span><span class="p">.</span><span class="n">exec</span><span class="p">(</span><span class="n">op</span><span class="p">,</span><span class="n">graph</span><span class="p">)</span> <span class="p">;</span>

<span class="n">QueryIterator</span> <span class="n">qIter</span> <span class="o">=</span> <span class="n">Algebra</span><span class="p">.</span><span class="n">exec</span><span class="p">(</span><span class="n">op</span><span class="p">,</span><span class="n">datasetGraph</span><span class="p">)</span> <span class="p">;</span>
</pre></div>


<p>Evaluating an algebra expression produces a iterator of query
solutions (called Bindings).</p>
<div class="codehilite"><pre><span class="k">for</span> <span class="p">(</span> <span class="p">;</span> <span class="n">qIter</span><span class="p">.</span><span class="n">hasNext</span><span class="p">()</span> <span class="p">;</span> <span class="p">)</span>
<span class="p">{</span>
   <span class="n">Binding</span> <span class="n">b</span> <span class="o">=</span> <span class="n">qIter</span><span class="p">.</span><span class="n">nextBinding</span><span class="p">()</span> <span class="p">;</span>
   <span class="n">Node</span> <span class="n">n</span> <span class="o">=</span> <span class="n">b</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">var_x</span><span class="p">)</span> <span class="p">;</span>
   <span class="n">System</span><span class="p">.</span><span class="n">out</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">var_x</span><span class="o">+</span><span class="s">&quot; = &quot;</span><span class="o">+</span><span class="n">FmtUtils</span><span class="p">.</span><span class="n">stringForNode</span><span class="p">(</span><span class="n">n</span><span class="p">))</span> <span class="p">;</span>
<span class="p">}</span>
<span class="n">qIter</span><span class="p">.</span><span class="n">close</span><span class="p">()</span> <span class="p">;</span>
</pre></div>


<p>Operations of <code>CONSTRUCT</code>, <code>DESCRIBE</code> and <code>ASK</code> are done on on top
of algebra evaluation. Applications can access this functionality
by creating their own <code>QueryEngine</code> (see
<code>arq.examples.engine.MyQueryEngine</code>) and it's factory. A query
engine is a one-time use object for each query execution.</p>
<p><a href="index.html">ARQ documentation index</a></p>
  </div>
</div>

	<hr>
    <div id="footer">
    <div class="copyright">
      <p>
        Copyright &copy; 2011&ndash;2013 The Apache Software Foundation, Licensed under
        the <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a>.
        <br />
        Apache Jena, Jena, the Apache Jena project logo,
        Apache and the Apache feather logos are trademarks of The Apache Software Foundation.
      </p>
    </div>
  </div>
      
      
</div><!--/.container -->

</body>
</html>
