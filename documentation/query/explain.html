<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<!--

    Licensed to the Apache Software Foundation (ASF) under one or more
    contributor license agreements.  See the NOTICE file distributed with
    this work for additional information regarding copyright ownership.
    The ASF licenses this file to You under the Apache License, Version 2.0
    (the "License"); you may not use this file except in compliance with
    the License.  You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE- 2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
-->

  <link href="/jena-doc/css/bootstrap.min.css" rel="stylesheet" type="text/css">
  <link href="/jena-doc/css/bootstrap-extension.css" rel="stylesheet" type="text/css">

  <title>Apache Jena - explaining ARQ queries</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>
  <script src="/jena-doc/js/jena-navigation.js" type="text/javascript"></script>
  <script src="/jena-doc/js/bootstrap.min.js" type="text/javascript"></script>
</head>

<body>
    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
        <a class="brand" href="/jena-doc/index.html" style="padding-top: 6px; padding-bottom: 0px;">
            <img class="logo-menu" src="/jena-doc/images/jena-logo/jena-logo-notext-small.png" alt="jena logo">
          </a>
          <a class="brand" href="/jena-doc/index.html">Apache Jena</a>
          <div class="nav-collapse collapse">
            <ul class="nav">
              <li id="homepage"><a href="/jena-doc/index.html"><i class="icon-home"></i> Home</a></li>
              <li id="download"><a href="/jena-doc/download/index.html"><i class="icon-download-alt"></i> Download</a></li>
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="icon-book"></i> Learn <b class="caret"></b></a>
                <ul class="dropdown-menu">
                  <li class="nav-header">Tutorials</li>
                  <li><a href="/jena-doc/tutorials/index.html">Overview</a></li>
                  <li><a href="/jena-doc/tutorials/rdf_api.html">RDF core API tutorial</a></li>
                  <li><a href="/jena-doc/tutorials/sparql.html">SPARQL tutorial</a></li>
                  <li><a href="/jena-doc/documentation/query/manipulating_sparql_using_arq.html">Manipulating SPARQL using ARQ</a></li>
                  <li><a href="/jena-doc/tutorials/using_jena_with_eclipse.html">Using Jena with Eclipse</a></li>
                  <li><a href="/jena-doc/documentation/notes/index.html">How-To's</a></li>
                  <li class="divider"></li>
                  <li class="nav-header">References</li>
                  <li><a href="/jena-doc/documentation/index.html">Overview</a></li>
                  <li><a href="/jena-doc/documentation/javadoc/">Javadoc</a></li>
                  <li><a href="/jena-doc/documentation/rdf/index.html">RDF API</a></li>
                  <li><a href="/jena-doc/documentation/io/">RDF I/O</a></li>
                  <li><a href="/jena-doc/documentation/query/index.html">ARQ (SPARQL)</a></li>
                  <li><a href="/jena-doc/documentation/query/text-query.html">Text Search</a></li>
                  <li><a href="/jena-doc/documentation/tdb/index.html">TDB</a></li>
                  <li><a href="/jena-doc/documentation/sdb/index.html">SDB</a></li>
                  <li><a href="/jena-doc/documentation/serving_data/index.html">Fuseki</a></li>
                  <li><a href="/jena-doc/documentation/assembler/index.html">Assembler</a></li>
                  <li><a href="/jena-doc/documentation/ontology/">Ontology API</a></li>
                  <li><a href="/jena-doc/documentation/inference/index.html">Inference API</a></li>
                  <li><a href="/jena-doc/documentation/tools/index.html">Command-line tools</a></li>
                </ul>
              </li>
              <li id="ask"><a href="/jena-doc/help_and_support/index.html"><i class="icon-question-sign"></i> Ask</a></li>
              
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="icon-bullhorn"></i> Get involved <b class="caret"></b></a>
                <ul class="dropdown-menu">
                  <li><a href="/jena-doc/getting_involved/index.html">Contribute</a></li>
                  <li><a href="/jena-doc/help_and_support/bugs_and_suggestions.html">Report a bug</a></li>
                  <li class="divider"></li>
                  <li class="nav-header">Project</li>
                  <li><a href="/jena-doc/about_jena/about.html">About Jena</a></li>
                  <li><a href="/jena-doc/about_jena/roadmap.html">Roadmap</a></li>
                  <li><a href="/jena-doc/about_jena/architecture.html">Architecture</a></li>
                  <li><a href="/jena-doc/about_jena/team.html">Project team</a></li>
                  <li><a href="/jena-doc/about_jena/contributions.html">Related projects</a></li>
                  <li class="divider"></li>
                  <li class="nav-header">ASF</li>
                  <li><a href="http://www.apache.org/">Apache Software Foundation</a></li>
                  <li><a href="http://www.apache.org/licenses/LICENSE-2.0">License</a></li>
                  <li><a href="http://www.apache.org/foundation/thanks.html">Thanks</a></li>
                  <li><a href="http://www.apache.org/foundation/sponsorship.html">Become a Sponsor</a></li>
                  <li><a href="http://www.apache.org/security/">Security</a></li>
                </ul>
              </li>
            </ul>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>


<div class="container">
	<div class="row-fluid">
	<div class="span12">
	<h1 class="title">explaining ARQ queries</h1>
  <p><em>This page applies to ARQ version 2.8.6 and later. In this version query
logging was consolidated and made uniform across ARQ, SDB and TDB.
Details of TDB logging changed to use this logging and explanation
framework from TDB version 0.8.8.</em></p>
<p>Optimization in ARQ proceeds on two levels. After the query is parsed,
the SPARQL algebra for the query is generated as described in the SPARQL
specification. High-level optimization occurs by rewriting the algebra
into new, equivalent algebra forms and introducing specialized algebra
operators. During query execution, the low-level, storage-specific
optimization occurs such as choosing the order of triple patterns within
basic graph patterns.</p>
<p>The effect of <a href="#algebra-transformations">high-level optimizations</a> can
be seen using <code>arq.qparse</code> and the low-level runtime optimziations can
be seen by <a href="#execution-logging">execution logging</a>.</p>
<h2 id="algebra-transformations">Algebra Transformations</h2>
<p>The preparation for a query for execution can be investigated with the
command <code>arq.qparse --explain --query QueryFile.rq</code>. Different storage
systems may perform different optimizations, usually chosen from the
standard set. <code>qparse</code> shows the action of the memory-storage optimizer
which applies all optimizations.</p>
<p>Other useful arguments are:</p>
<p><strong>qparse arguments</strong></p>
<table>
<thead>
<tr>
<th>Argument</th>
<th>Effect</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>--print=query</code></td>
<td>Print the parsed query</td>
</tr>
<tr>
<td><code>--print=op</code></td>
<td>Print the SPARQL algebra for the query. This is exactly the algebra specified by the SPARQL standard.</td>
</tr>
<tr>
<td><code>--print=opt</code></td>
<td>Print the optimized algebra for the query.</td>
</tr>
<tr>
<td><code>--print=quad</code></td>
<td>Print the quad form algebra for the query.</td>
</tr>
<tr>
<td><code>--print=optquad</code></td>
<td>Print the quad-form optimized algebra for the query.</td>
</tr>
</tbody>
</table>
<p>The argument <code>--explain</code> is equivalent to <code>--print=query --print=opt</code></p>
<p>Examples:</p>
<div class="codehilite"><pre><span class="n">arq</span><span class="p">.</span><span class="n">qparse</span> <span class="o">--</span><span class="n">explain</span> <span class="o">--</span><span class="n">query</span> <span class="n">Q</span><span class="p">.</span><span class="n">rq</span>

<span class="n">arq</span><span class="p">.</span><span class="n">qparse</span> <span class="o">--</span><span class="n">explain</span> <span class="err">&#39;</span><span class="n">SELECT</span> <span class="o">*</span> <span class="p">{</span><span class="err"> </span><span class="o">?</span><span class="n">s</span><span class="err"> </span><span class="o">?</span><span class="n">p</span><span class="err"> </span><span class="o">?</span><span class="n">o</span> <span class="p">}</span><span class="err">&#39;</span>
</pre></div>


<h2 id="execution-logging">Execution Logging</h2>
<p>ARQ can log query and update execution details globally or for an
individual operations. This adds another level of control on top of the
logger level controls.</p>
<p>From command line:</p>
<div class="codehilite"><pre><span class="n">arq</span><span class="p">.</span><span class="n">sparql</span> <span class="o">--</span><span class="n">explain</span> <span class="o">--</span><span class="n">data</span> <span class="p">...</span> <span class="o">--</span><span class="n">query</span> <span class="p">...</span>
</pre></div>


<p>Explanatory messages are controlled by the <code>Explain.InfoLevel</code> level in
the execution context.</p>
<p>Execution logging at level <code>ALL</code> can cause a significant slowdown in
query execution speeds but the order of operations logged will be
correct.</p>
<p>The logger used is called <code>com.hp.hpl.jena.arq.exec</code>. Message are sent
at level "info". So for log4j, the following can be set in the
log4j.properties file:</p>
<div class="codehilite"><pre><span class="n">log4j</span><span class="p">.</span><span class="n">logger</span><span class="p">.</span><span class="n">com</span><span class="p">.</span><span class="n">hp</span><span class="p">.</span><span class="n">hpl</span><span class="p">.</span><span class="n">jena</span><span class="p">.</span><span class="n">arq</span><span class="p">.</span><span class="n">exec</span><span class="o">=</span><span class="n">INFO</span>
</pre></div>


<p>The context setting is for key (Java constant) <code>ARQ.symLogExec</code>. To set
globally:</p>
<div class="codehilite"><pre><span class="n">ARQ</span><span class="p">.</span><span class="n">setExecutionLogging</span><span class="p">(</span><span class="n">Explain</span><span class="p">.</span><span class="n">InfoLevel</span><span class="p">.</span><span class="n">ALL</span><span class="p">)</span><span class="err"> </span><span class="p">;</span>
</pre></div>


<p>and it may also be set on an individual query execution using it's local
context.</p>
<div class="codehilite"><pre> <span class="n">QueryExecutiuon</span> <span class="n">qExec</span> <span class="o">=</span> <span class="n">QueryExecutionFactory</span><span class="p">.</span><span class="n">create</span><span class="p">(...)</span><span class="err"> </span><span class="p">;</span>
 <span class="n">qExec</span><span class="p">.</span><span class="n">getContext</span><span class="p">().</span><span class="n">set</span><span class="p">(</span><span class="n">ARQ</span><span class="p">.</span><span class="n">symLogExec</span><span class="p">,</span> <span class="n">Explain</span><span class="p">.</span><span class="n">InfoLevel</span><span class="p">.</span><span class="n">ALL</span><span class="p">)</span><span class="err"> </span><span class="p">;</span>
</pre></div>


<p>On the command line:</p>
<div class="codehilite"><pre> <span class="n">arq</span><span class="p">.</span><span class="n">query</span> <span class="o">--</span><span class="n">explain</span> <span class="o">--</span><span class="n">data</span> <span class="n">data</span> <span class="n">file</span> <span class="o">--</span><span class="n">query</span><span class="o">=</span><span class="n">queryfile</span>
</pre></div>


<p>The command tdbquery takes the same --explain argument.</p>
<p>Logging information levels: see the <a href="logging.html">logging page</a></p>
  </div>
</div>

</div><!--/.container -->

    <footer class="footer">
      <div class="container">
        <p>Copyright &copy; 2011&ndash;2013 The Apache Software Foundation, Licensed under
        the <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a>.
        </p>
        <p>
        Apache Jena, Jena, the Apache Jena project logo,
        Apache and the Apache feather logos are trademarks of The Apache Software Foundation.
        </p>
      </div>
  </footer>
      

</body>
</html>
