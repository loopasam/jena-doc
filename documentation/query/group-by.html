<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<!--

    Licensed to the Apache Software Foundation (ASF) under one or more
    contributor license agreements.  See the NOTICE file distributed with
    this work for additional information regarding copyright ownership.
    The ASF licenses this file to You under the Apache License, Version 2.0
    (the "License"); you may not use this file except in compliance with
    the License.  You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE- 2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
-->

  <link href="/jena-doc/css/bootstrap.min.css" rel="stylesheet" type="text/css">
  <link href="/jena-doc/css/bootstrap-extension.css" rel="stylesheet" type="text/css">

  <title>Apache Jena - ARQ - Aggregates</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>
  <script src="/jena-doc/js/jena-navigation.js" type="text/javascript"></script>
  <script src="/jena-doc/js/bootstrap.min.js" type="text/javascript"></script>
</head>

<body>
    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
        <a class="brand" href="/jena-doc/index.html" style="padding-top: 6px; padding-bottom: 0px;">
            <img class="logo-menu" src="/jena-doc/images/jena-logo/jena-logo-notext-small.png" alt="jena logo">
          </a>
          <a class="brand" href="/jena-doc/index.html">Apache Jena</a>
          <div class="nav-collapse collapse">
            <ul class="nav">
              <li id="homepage"><a href="/jena-doc/index.html"><i class="icon-home"></i> Home</a></li>
              <li id="download"><a href="/jena-doc/download/index.html"><i class="icon-download-alt"></i> Download</a></li>
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="icon-book"></i> Learn <b class="caret"></b></a>
                <ul class="dropdown-menu">
                  <li class="nav-header">Tutorials</li>
                  <li><a href="/jena-doc/tutorials/index.html">Overview</a></li>
                  <li><a href="/jena-doc/tutorials/rdf_api.html">RDF core API tutorial</a></li>
                  <li><a href="/jena-doc/tutorials/sparql.html">SPARQL tutorial</a></li>
                  <li><a href="/jena-doc/documentation/query/manipulating_sparql_using_arq.html">Manipulating SPARQL using ARQ</a></li>
                  <li><a href="/jena-doc/tutorials/using_jena_with_eclipse.html">Using Jena with Eclipse</a></li>
                  <li><a href="/jena-doc/documentation/notes/index.html">How-To's</a></li>
                  <li class="divider"></li>
                  <li class="nav-header">References</li>
                  <li><a href="/jena-doc/documentation/index.html">Overview</a></li>
                  <li><a href="/jena-doc/documentation/javadoc/">Javadoc</a></li>
                  <li><a href="/jena-doc/documentation/rdf/index.html">RDF API</a></li>
                  <li><a href="/jena-doc/documentation/io/">RDF I/O</a></li>
                  <li><a href="/jena-doc/documentation/query/index.html">ARQ (SPARQL)</a></li>
                  <li><a href="/jena-doc/documentation/query/text-query.html">Text Search</a></li>
                  <li><a href="/jena-doc/documentation/tdb/index.html">TDB</a></li>
                  <li><a href="/jena-doc/documentation/sdb/index.html">SDB</a></li>
                  <li><a href="/jena-doc/documentation/serving_data/index.html">Fuseki</a></li>
                  <li><a href="/jena-doc/documentation/assembler/index.html">Assembler</a></li>
                  <li><a href="/jena-doc/documentation/ontology/">Ontology API</a></li>
                  <li><a href="/jena-doc/documentation/inference/index.html">Inference API</a></li>
                  <li><a href="/jena-doc/documentation/tools/index.html">Command-line tools</a></li>
                </ul>
              </li>
              <li id="ask"><a href="/jena-doc/help_and_support/index.html"><i class="icon-question-sign"></i> Ask</a></li>
              
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="icon-bullhorn"></i> Get involved <b class="caret"></b></a>
                <ul class="dropdown-menu">
                  <li><a href="/jena-doc/getting_involved/index.html">Contribute</a></li>
                  <li><a href="/jena-doc/help_and_support/bugs_and_suggestions.html">Report a bug</a></li>
                  <li class="divider"></li>
                  <li class="nav-header">Project</li>
                  <li><a href="/jena-doc/about_jena/about.html">About Jena</a></li>
                  <li><a href="/jena-doc/about_jena/roadmap.html">Roadmap</a></li>
                  <li><a href="/jena-doc/about_jena/architecture.html">Architecture</a></li>
                  <li><a href="/jena-doc/about_jena/team.html">Project team</a></li>
                  <li><a href="/jena-doc/about_jena/contributions.html">Related projects</a></li>
                  <li class="divider"></li>
                  <li class="nav-header">ASF</li>
                  <li><a href="http://www.apache.org/">Apache Software Foundation</a></li>
                  <li><a href="http://www.apache.org/licenses/LICENSE-2.0">License</a></li>
                  <li><a href="http://www.apache.org/foundation/thanks.html">Thanks</a></li>
                  <li><a href="http://www.apache.org/foundation/sponsorship.html">Become a Sponsor</a></li>
                  <li><a href="http://www.apache.org/security/">Security</a></li>
                </ul>
              </li>
            </ul>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>


<div class="container">
	<div class="row-fluid">
	<div class="span12">
	<h1 class="title">ARQ - Aggregates</h1>
  <p>ARQ includes support for GROUP BY and counting.  This was previously an ARQ extension but is now legal SPARQL 1.1</p>
<h2 id="group-by">GROUP BY</h2>
<p>A <code>GROUP BY</code> clause transforms a result set so that only one row
will appear for each unique set of grouping variables. All other
variables from the query pattern are projected away and are not
available in the <code>SELECT</code> clause.</p>
<div class="codehilite"><pre><span class="n">PREFIX</span>

<span class="n">SELECT</span> <span class="o">?</span><span class="n">p</span> <span class="o">?</span><span class="n">q</span>
<span class="p">{</span> <span class="p">.</span> <span class="p">.</span> <span class="p">.</span>
<span class="p">}</span>
<span class="n">GROUP</span> <span class="n">BY</span> <span class="o">?</span><span class="n">p</span> <span class="o">?</span><span class="n">q</span>
</pre></div>


<p><code>SELECT *</code> will include variables from the <code>GROUP BY</code> but no
others. This ensures that results are always the same - including
other variables from the pattern would involve choosing some value
that was not constant across each section of the group and so lead
to indeterminate results.</p>
<p>The <code>GROUP BY</code> clause can involve an expression. If the expression
is named, then the value is included in the columns, before
projection. An unnamed expression is used for grouping but the
value is not placed in the result set formed by the <code>GROUP BY</code>
clause.</p>
<div class="codehilite"><pre><span class="n">SELECT</span> <span class="o">?</span><span class="n">productId</span> <span class="o">?</span><span class="n">cost</span>
<span class="p">{</span> <span class="p">.</span> <span class="p">.</span> <span class="p">.</span>
<span class="p">}</span>
<span class="n">GROUP</span> <span class="n">BY</span> <span class="o">?</span><span class="n">productId</span> <span class="p">(</span><span class="o">?</span><span class="n">num</span> <span class="o">*</span> <span class="o">?</span><span class="n">price</span> <span class="n">AS</span> <span class="o">?</span><span class="n">cost</span><span class="p">)</span>
</pre></div>


<h2 id="having">HAVING</h2>
<p>A query may specify a HAVING clause to apply a filter to the result
set after grouping. The filter may involve variables from the
<code>GROUP BY</code> clause or aggregations.</p>
<div class="codehilite"><pre><span class="n">SELECT</span> <span class="o">?</span><span class="n">p</span> <span class="o">?</span><span class="n">q</span>
<span class="p">{</span> <span class="p">.</span> <span class="p">.</span> <span class="p">.</span>
<span class="p">}</span>
<span class="n">GROUP</span> <span class="n">BY</span> <span class="o">?</span><span class="n">p</span> <span class="o">?</span><span class="n">q</span>
<span class="n">HAVING</span> <span class="p">(</span><span class="n">count</span><span class="p">(</span><span class="n">distinct</span> <span class="o">*</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>


<h2 id="aggregation">Aggregation</h2>
<p>Currently supported aggregations:</p>
<table>
<thead>
<tr>
<th>Aggregator</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>count(*)</code></td>
<td>Count rows of each group element, or the whole result set if no <code>GROUP BY</code>.</td>
</tr>
<tr>
<td><code>count(distinct *)</code></td>
<td>Count the distinct rows of each group element, or the whole result set if no <code>GROUP BY</code>.</td>
</tr>
<tr>
<td><code>count(?var)</code></td>
<td>Count the number of times <code>?var</code> is bound in a group.</td>
</tr>
<tr>
<td><code>count(distinct ?var)</code></td>
<td>Count the number of distinct values <code>?var</code> is bound to in a group.</td>
</tr>
<tr>
<td><code>sum(?x)</code></td>
<td>Sum the variable over the group (non-numeric values and unbound values are ignored).</td>
</tr>
</tbody>
</table>
<p>When a variable is used, what is being counted is occurrences of
RDF terms, that is names. It is not a count of individuals because
two names can refer to the same individual.</p>
<p>If there was no explicit <code>GROUP BY</code> clause, then it is as if the
whole of the result set forms a single group element.Â 
Equivalently, it is <code>GROUP BY</code> of no variables. Only aggregation
expressions make sense in the SELECT clause as theer are no
variables from the query pattern to project out.</p>
<p><a href="index.html">ARQ documentation index</a></p>
  </div>
</div>

</div><!--/.container -->

    <footer class="footer">
      <div class="container">
        <p>Copyright &copy; 2011&ndash;2013 The Apache Software Foundation, Licensed under
        the <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a>.
        </p>
        <p>
        Apache Jena, Jena, the Apache Jena project logo,
        Apache and the Apache feather logos are trademarks of The Apache Software Foundation.
        </p>
      </div>
  </footer>
      

</body>
</html>
