<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<!--

    Licensed to the Apache Software Foundation (ASF) under one or more
    contributor license agreements.  See the NOTICE file distributed with
    this work for additional information regarding copyright ownership.
    The ASF licenses this file to You under the Apache License, Version 2.0
    (the "License"); you may not use this file except in compliance with
    the License.  You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE- 2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
-->

  <link href="/jena-doc/css/bootstrap.min.css" rel="stylesheet" type="text/css">
  <link href="/jena-doc/css/bootstrap-extension.css" rel="stylesheet" type="text/css">

  <title>Apache Jena - Text searches with SPARQL</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>
  <script src="/jena-doc/js/jena-navigation.js" type="text/javascript"></script>
  <script src="/jena-doc/js/bootstrap.min.js" type="text/javascript"></script>
</head>

<body>
    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
        <a class="brand" href="/jena-doc/index.html" style="padding-top: 6px; padding-bottom: 0px;">
            <img class="logo-menu" src="/jena-doc/images/jena-logo/jena-logo-notext-small.png" alt="jena logo">
          </a>
          <a class="brand" href="/jena-doc/index.html">Apache Jena</a>
          <div class="nav-collapse collapse">
            <ul class="nav">
              <li id="homepage"><a href="/jena-doc/index.html"><i class="icon-home"></i> Home</a></li>
              <li id="download"><a href="/jena-doc/download/index.html"><i class="icon-download-alt"></i> Download</a></li>
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="icon-book"></i> Learn <b class="caret"></b></a>
                <ul class="dropdown-menu">
                  <li class="nav-header">Tutorials</li>
                  <li><a href="/jena-doc/tutorials/index.html">Overview</a></li>
                  <li><a href="/jena-doc/tutorials/rdf_api.html">RDF core API tutorial</a></li>
                  <li><a href="/jena-doc/tutorials/sparql.html">SPARQL tutorial</a></li>
                  <li><a href="/jena-doc/documentation/query/manipulating_sparql_using_arq.html">Manipulating SPARQL using ARQ</a></li>
                  <li><a href="/jena-doc/tutorials/using_jena_with_eclipse.html">Using Jena with Eclipse</a></li>
                  <li><a href="/jena-doc/documentation/notes/index.html">How-To's</a></li>
                  <li class="divider"></li>
                  <li class="nav-header">References</li>
                  <li><a href="/jena-doc/documentation/index.html">Overview</a></li>
                  <li><a href="/jena-doc/documentation/javadoc/">Javadoc</a></li>
                  <li><a href="/jena-doc/documentation/rdf/index.html">RDF API</a></li>
                  <li><a href="/jena-doc/documentation/io/">RDF I/O</a></li>
                  <li><a href="/jena-doc/documentation/query/index.html">ARQ (SPARQL)</a></li>
                  <li><a href="/jena-doc/documentation/query/text-query.html">Text Search</a></li>
                  <li><a href="/jena-doc/documentation/tdb/index.html">TDB</a></li>
                  <li><a href="/jena-doc/documentation/sdb/index.html">SDB</a></li>
                  <li><a href="/jena-doc/documentation/serving_data/index.html">Fuseki</a></li>
                  <li><a href="/jena-doc/documentation/assembler/index.html">Assembler</a></li>
                  <li><a href="/jena-doc/documentation/ontology/">Ontology API</a></li>
                  <li><a href="/jena-doc/documentation/inference/index.html">Inference API</a></li>
                  <li><a href="/jena-doc/documentation/tools/index.html">Command-line tools</a></li>
                </ul>
              </li>
              <li id="ask"><a href="/jena-doc/help_and_support/index.html"><i class="icon-question-sign"></i> Ask</a></li>
              
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="icon-bullhorn"></i> Get involved <b class="caret"></b></a>
                <ul class="dropdown-menu">
                  <li><a href="/jena-doc/getting_involved/index.html">Contribute</a></li>
                  <li><a href="/jena-doc/help_and_support/bugs_and_suggestions.html">Report a bug</a></li>
                  <li class="divider"></li>
                  <li class="nav-header">Project</li>
                  <li><a href="/jena-doc/about_jena/about.html">About Jena</a></li>
                  <li><a href="/jena-doc/about_jena/roadmap.html">Roadmap</a></li>
                  <li><a href="/jena-doc/about_jena/architecture.html">Architecture</a></li>
                  <li><a href="/jena-doc/about_jena/team.html">Project team</a></li>
                  <li><a href="/jena-doc/about_jena/contributions.html">Related projects</a></li>
                  <li class="divider"></li>
                  <li class="nav-header">ASF</li>
                  <li><a href="http://www.apache.org/">Apache Software Foundation</a></li>
                  <li><a href="http://www.apache.org/licenses/LICENSE-2.0">License</a></li>
                  <li><a href="http://www.apache.org/foundation/thanks.html">Thanks</a></li>
                  <li><a href="http://www.apache.org/foundation/sponsorship.html">Become a Sponsor</a></li>
                  <li><a href="http://www.apache.org/security/">Security</a></li>
                </ul>
              </li>
            </ul>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>


<div class="container">
	<div class="row-fluid">
	<div class="span12">
	<h1 class="title">Text searches with SPARQL</h1>
  <p>This module was first released with Jena 2.10.2.</p>
<p>This extension to ARQ combines SPARQL and text search.</p>
<p>It gives applications the ability to perform free text searches within
SPARQL queries. Text indexes are additional information for
accessing the RDF graph.</p>
<p>The text index can be either <a href="http://lucene.apache.org/core">Apache Lucene</a> for a
same-machine text index, or <a href="http://lucene.apache.org/solr/">Apache Solr</a>
for a large scale enterprise search application.</p>
<p>Some example code is <a href="https://svn.apache.org/repos/asf/jena/trunk/jena-text/src/main/java/examples/">available here</a>.</p>
<p>This module is not compatible with the much older LARQ module.</p>
<p><em>Illustration</em></p>
<p>This query makes a text query for 'word' on a specific property
(the index needs to correctly configured) and limits the output
to 10 matches; it then looks in the RDF data for
the actual label.  More details are given below.</p>
<div class="codehilite"><pre><span class="n">PREFIX</span> <span class="n">text</span><span class="o">:</span> <span class="o">&lt;</span><span class="n">http</span><span class="o">:</span><span class="c1">//jena.apache.org/text#&gt;</span>
<span class="n">PREFIX</span> <span class="n">rdfs</span><span class="o">:</span> <span class="o">&lt;</span><span class="n">http</span><span class="o">:</span><span class="c1">//www.w3.org/2000/01/rdf-schema#&gt;</span>

<span class="n">SELECT</span> <span class="o">?</span><span class="n">s</span>
<span class="p">{</span> <span class="o">?</span><span class="n">s</span> <span class="n">text</span><span class="o">:</span><span class="n">query</span> <span class="p">(</span><span class="n">rdfs</span><span class="o">:</span><span class="n">label</span> <span class="err">&#39;</span><span class="n">word</span><span class="err">&#39;</span> <span class="mi">10</span><span class="p">)</span> <span class="p">;</span> 
     <span class="n">rdfs</span><span class="o">:</span><span class="n">label</span> <span class="o">?</span><span class="n">label</span> 
<span class="p">}</span>
</pre></div>


<h2 id="table-of-contents">Table of Contents</h2>
<ul>
<li><a href="#architecture">Architecture</a></li>
<li><a href="#query-with-sparql">Query with SPARQL</a></li>
<li><a href="#configuration">Configuration</a><ul>
<li><a href="#text-dataset-assembler">Text Dataset Assembler</a></li>
<li><a href="#configuration-by-code">Configuration by Code</a></li>
</ul>
</li>
<li><a href="#working-with-fuseki">Working with Fuseki</a></li>
<li><a href="#building-a-text-index">Building a Text Index</a></li>
<li><a href="#deletion-of-indexed-entities">Deletion of Indexed Entities</a></li>
<li><a href="#maven-dependency">Maven Dependency</a></li>
</ul>
<h2 id="architecture">Architecture</h2>
<p>The text index is used provide a reverse index mapping query strings to URIs.
The text indexed can be part of the RDF data or the text index can be used to index
external content with only additional RDF in the RDF store.</p>
<p>The text index uses the native query language of the index:
<a href="http://lucene.apache.org/core/4_1_0/queryparser/org/apache/lucene/queryparser/classic/package-summary.html#package_description">Lucene query format</a>
or
<a href="http://wiki.apache.org/solr/SolrQuerySyntax">Solr query format</a>.</p>
<p>A text-supporting dataset is configured with a description of which
properties work with.  When data is added, any properties matching the
description caus an entry to be added from analysed text from the triple
object and mapping to the subject.</p>
<h3 id="pattern-a-wzxhzdk15-rdf-data">Pattern A &ndash; RDF data</h3>
<p>In this pattern, the data in the text index is indexing literals in the RDF data.<br />
Additions to the RDF data are reflected in additions to the index.</p>
<p>(Deletes do not remove text index entries - <a href="#deletion">see below</a>)</p>
<h3 id="pattern-b-wzxhzdk16-external-content">Pattern B &ndash; External content</h3>
<p>There is no requirement that the text data indexed is present in the RDF
data.  As long as the index contains the index text documents to match the
index description, then text search can be performed.</p>
<p>For example, if the content of a collection of documents is indexed and the
URI naming the document is the result of the text search, then an RDF
dataset with the document metadata can be combined with accessing the
content by URI.</p>
<p>The maintence of the index is external to the RDF data store.</p>
<h3 id="external-applications">External applications</h3>
<p>By using Solr, in either pattern A (RDF data indexed) or pattern B
(external content indexed), other applications can share the
text index with SPARQL search.</p>
<h2 id="query-with-sparql">Query with SPARQL</h2>
<p>The property function is <code>http://jena.apache.org/text#query</code> more
conveniently writtern:</p>
<div class="codehilite"><pre><span class="n">PREFIX</span> <span class="n">text</span><span class="o">:</span> <span class="o">&lt;</span><span class="n">http</span><span class="o">:</span><span class="c1">//jena.apache.org/text#&gt;</span>

<span class="p">...</span>   <span class="n">text</span><span class="o">:</span><span class="n">query</span> <span class="p">...</span>
</pre></div>


<p>This is different to LARQ v1.</p>
<p>The following forms are all legal:</p>
<div class="codehilite"><pre><span class="o">?</span><span class="n">s</span> <span class="n">text</span><span class="o">:</span><span class="n">query</span> <span class="err">&#39;</span><span class="n">word</span><span class="err">&#39;</span>              <span class="err">#</span> <span class="n">query</span>
<span class="o">?</span><span class="n">s</span> <span class="n">text</span><span class="o">:</span><span class="n">query</span> <span class="p">(</span><span class="n">rdfs</span><span class="o">:</span><span class="n">label</span> <span class="err">&#39;</span><span class="n">word</span><span class="err">&#39;</span><span class="p">)</span> <span class="err">#</span> <span class="n">query</span> <span class="n">specific</span> <span class="n">property</span> <span class="k">if</span> <span class="n">multiple</span>
<span class="o">?</span><span class="n">s</span> <span class="n">text</span><span class="o">:</span><span class="n">query</span> <span class="p">(</span><span class="err">&#39;</span><span class="n">word</span><span class="err">&#39;</span> <span class="mi">10</span><span class="p">)</span>         <span class="err">#</span> <span class="n">with</span> <span class="n">limit</span> <span class="n">on</span> <span class="n">results</span>
</pre></div>


<p>The most general form is:</p>
<div class="codehilite"><pre><span class="o">?</span><span class="n">s</span> <span class="n">text</span><span class="o">:</span><span class="n">query</span> <span class="p">(</span><span class="n">property</span> <span class="err">&#39;</span><span class="n">query</span> <span class="n">string</span><span class="sc">&#39; &#39;</span><span class="n">limit</span><span class="err">&#39;</span><span class="p">)</span>
</pre></div>


<p>Only the query string is required, and if it is the only argument the
surrounding <code>( )</code> can be omitted.</p>
<p>The property URI is only necessary if multiple properties have been indexed.</p>
<table>
<thead>
<tr>
<th>&nbsp;Argument&nbsp;</th>
<th>&nbsp; Definition&nbsp;</th>
</tr>
</thead>
<tbody>
<tr>
<td>property</td>
<td>The URI (inc prefix name form)</td>
</tr>
<tr>
<td>query string</td>
<td>The native query string</td>
</tr>
<tr>
<td>limit</td>
<td>The limit on the results</td>
</tr>
</tbody>
</table>
<h3 id="good-practice">Good practice</h3>
<p>The query execution does not know the selectivity of the text index.  It is
better to use one of two styles.</p>
<h4 id="query-pattern-1-wzxhzdk17-find-in-the-text-index-and-enhance-results">Query pattern 1 &ndash; Find in the text index and enhance results</h4>
<p>Access to the index is first in the query and used to find a number of
items of interest; further information is obtained about these items from
the RDF data.</p>
<div class="codehilite"><pre><span class="n">SELECT</span> <span class="o">?</span><span class="n">s</span>
<span class="p">{</span> <span class="o">?</span><span class="n">s</span> <span class="n">text</span><span class="o">:</span><span class="n">query</span> <span class="p">(</span><span class="n">rdfs</span><span class="o">:</span><span class="n">label</span> <span class="err">&#39;</span><span class="n">word</span><span class="err">&#39;</span> <span class="mi">10</span><span class="p">)</span> <span class="p">;</span> 
     <span class="n">rdfs</span><span class="o">:</span><span class="n">label</span> <span class="o">?</span><span class="n">label</span> <span class="p">;</span>
     <span class="nl">rdf:</span><span class="n">type</span>   <span class="o">?</span><span class="n">type</span> 
<span class="p">}</span>
</pre></div>


<p>Limit is useful here when working with large indexes to limit results to the
more higher scoring results.</p>
<h4 id="query-pattern-2-wzxhzdk18-filter">Query pattern 2 &ndash; Filter</h4>
<p>By finding items of interest first in the RDF data, the text search can be
used to restrict the items found still further.</p>
<div class="codehilite"><pre><span class="n">SELECT</span> <span class="o">?</span><span class="n">s</span>
<span class="p">{</span> <span class="o">?</span><span class="n">s</span> <span class="n">rdf</span><span class="o">:</span><span class="n">type</span>     <span class="o">:</span><span class="n">book</span> <span class="p">;</span>
     <span class="nl">dc:</span><span class="n">createor</span>  <span class="s">&quot;John&quot;</span> <span class="p">.</span>
  <span class="o">?</span><span class="n">s</span> <span class="n">text</span><span class="o">:</span><span class="n">query</span>   <span class="p">(</span><span class="n">dc</span><span class="o">:</span><span class="n">title</span> <span class="err">&#39;</span><span class="n">word</span><span class="err">&#39;</span><span class="p">)</span> <span class="p">;</span> 
<span class="p">}</span>
</pre></div>


<h2 id="configuration">Configuration</h2>
<p>The usual way to describe an index is with a 
<a href="../assembler/index.html">Jena assembler description</a>.  Configurations can
also be built with code. The assembler describes a 'text
dataset' which has an underlying RDF dataset and a text index. The text
index describes the text index technology (Lucene or Solr) and the details
needed for for each.</p>
<p>A text index has an "entity map" which defines the properties to
index, the name of the lucene/solr field and field used for storing the URI
itself.</p>
<p>For common RDF use, there will be one field, mapping a property to a text
index field. More complex setups, with multiple properties per enitity
(URI) are possible.</p>
<p>Once setup this way, any data added to the text dataset is automatically
indexed as well.</p>
<h3 id="text-dataset-assembler">Text Dataset Assembler</h3>
<p>The following is an example of a TDB dataset with a text index.</p>
<div class="codehilite"><pre><span class="err">@</span><span class="n">prefix</span> <span class="o">:</span>        <span class="o">&lt;</span><span class="n">http</span><span class="o">:</span><span class="c1">//localhost/jena_example/#&gt; .</span>
<span class="err">@</span><span class="n">prefix</span> <span class="n">rdf</span><span class="o">:</span>     <span class="o">&lt;</span><span class="n">http</span><span class="o">:</span><span class="c1">//www.w3.org/1999/02/22-rdf-syntax-ns#&gt; .</span>
<span class="err">@</span><span class="n">prefix</span> <span class="n">rdfs</span><span class="o">:</span>    <span class="o">&lt;</span><span class="n">http</span><span class="o">:</span><span class="c1">//www.w3.org/2000/01/rdf-schema#&gt; .</span>
<span class="err">@</span><span class="n">prefix</span> <span class="n">tdb</span><span class="o">:</span>     <span class="o">&lt;</span><span class="n">http</span><span class="o">:</span><span class="c1">//jena.hpl.hp.com/2008/tdb#&gt; .</span>
<span class="err">@</span><span class="n">prefix</span> <span class="n">ja</span><span class="o">:</span>      <span class="o">&lt;</span><span class="n">http</span><span class="o">:</span><span class="c1">//jena.hpl.hp.com/2005/11/Assembler#&gt; .</span>
<span class="err">@</span><span class="n">prefix</span> <span class="n">text</span><span class="o">:</span>    <span class="o">&lt;</span><span class="n">http</span><span class="o">:</span><span class="c1">//jena.apache.org/text#&gt; .</span>

<span class="cp">## Example of a TDB dataset and text index</span>
<span class="cp">## Initialize TDB</span>
<span class="p">[]</span> <span class="n">ja</span><span class="o">:</span><span class="n">loadClass</span> <span class="s">&quot;com.hp.hpl.jena.tdb.TDB&quot;</span> <span class="p">.</span>
<span class="nl">tdb:</span><span class="n">DatasetTDB</span>  <span class="n">rdfs</span><span class="o">:</span><span class="n">subClassOf</span>  <span class="n">ja</span><span class="o">:</span><span class="n">RDFDataset</span> <span class="p">.</span>
<span class="nl">tdb:</span><span class="n">GraphTDB</span>    <span class="n">rdfs</span><span class="o">:</span><span class="n">subClassOf</span>  <span class="n">ja</span><span class="o">:</span><span class="n">Model</span> <span class="p">.</span>

<span class="cp">## Initialize text query</span>
<span class="p">[]</span> <span class="n">ja</span><span class="o">:</span><span class="n">loadClass</span>       <span class="s">&quot;org.apache.jena.query.text.TextQuery&quot;</span> <span class="p">.</span>
<span class="cp"># A TextDataset is a regular dataset with a text index.</span>
<span class="nl">text:</span><span class="n">TextDataset</span>      <span class="n">rdfs</span><span class="o">:</span><span class="n">subClassOf</span>   <span class="n">ja</span><span class="o">:</span><span class="n">RDFDataset</span> <span class="p">.</span>
<span class="cp"># Lucene index</span>
<span class="nl">text:</span><span class="n">TextIndexLucene</span>  <span class="n">rdfs</span><span class="o">:</span><span class="n">subClassOf</span>   <span class="n">text</span><span class="o">:</span><span class="n">TextIndex</span> <span class="p">.</span>
<span class="cp"># Solr index</span>
<span class="nl">text:</span><span class="n">TextIndexSolrne</span>  <span class="n">rdfs</span><span class="o">:</span><span class="n">subClassOf</span>   <span class="n">text</span><span class="o">:</span><span class="n">TextIndex</span> <span class="p">.</span>

<span class="cp">## ---------------------------------------------------------------</span>
<span class="cp">## This URI must be fixed - it&#39;s used to assemble the text dataset.</span>

<span class="o">:</span><span class="n">text_dataset</span> <span class="n">rdf</span><span class="o">:</span><span class="n">type</span>     <span class="n">text</span><span class="o">:</span><span class="n">TextDataset</span> <span class="p">;</span>
    <span class="nl">text:</span><span class="n">dataset</span>   <span class="o">&lt;</span><span class="err">#</span><span class="n">dataset</span><span class="o">&gt;</span> <span class="p">;</span>
    <span class="nl">text:</span><span class="n">index</span>     <span class="o">&lt;</span><span class="err">#</span><span class="n">indexLucene</span><span class="o">&gt;</span> <span class="p">;</span>
    <span class="p">.</span>

<span class="cp"># A TDB datset used for RDF storage</span>
<span class="o">&lt;</span><span class="err">#</span><span class="n">dataset</span><span class="o">&gt;</span> <span class="n">rdf</span><span class="o">:</span><span class="n">type</span>      <span class="n">tdb</span><span class="o">:</span><span class="n">DatasetTDB</span> <span class="p">;</span>
    <span class="nl">tdb:</span><span class="n">location</span> <span class="s">&quot;DB&quot;</span> <span class="p">;</span>
    <span class="nl">tdb:</span><span class="n">unionDefaultGraph</span> <span class="nb">true</span> <span class="p">;</span> <span class="err">#</span> <span class="n">Optional</span>
    <span class="p">.</span>

<span class="cp"># Text index description</span>
<span class="o">&lt;</span><span class="err">#</span><span class="n">indexLucene</span><span class="o">&gt;</span> <span class="n">a</span> <span class="n">text</span><span class="o">:</span><span class="n">TextIndexLucene</span> <span class="p">;</span>
    <span class="nl">text:</span><span class="n">directory</span> <span class="o">&lt;</span><span class="n">file</span><span class="o">:</span><span class="n">Lucene</span><span class="o">&gt;</span> <span class="p">;</span>
    <span class="err">##</span><span class="n">text</span><span class="o">:</span><span class="n">directory</span> <span class="s">&quot;mem&quot;</span> <span class="p">;</span>
    <span class="nl">text:</span><span class="n">entityMap</span> <span class="o">&lt;</span><span class="err">#</span><span class="n">entMap</span><span class="o">&gt;</span> <span class="p">;</span>
    <span class="p">.</span>

<span class="cp"># Mapping in the index</span>
<span class="cp"># URI stored in field &quot;uri&quot;</span>
<span class="cp"># rdfs:label is mapped to field &quot;text&quot;</span>
<span class="o">&lt;</span><span class="err">#</span><span class="n">entMap</span><span class="o">&gt;</span> <span class="n">a</span> <span class="n">text</span><span class="o">:</span><span class="n">EntityMap</span> <span class="p">;</span>
    <span class="nl">text:</span><span class="n">entityField</span>      <span class="s">&quot;uri&quot;</span> <span class="p">;</span>
    <span class="nl">text:</span><span class="n">defaultField</span>     <span class="s">&quot;text&quot;</span> <span class="p">;</span>
    <span class="nl">text:</span><span class="n">map</span> <span class="p">(</span>
         <span class="p">[</span> <span class="n">text</span><span class="o">:</span><span class="n">field</span> <span class="s">&quot;text&quot;</span> <span class="p">;</span> <span class="n">text</span><span class="o">:</span><span class="n">predicate</span> <span class="n">rdfs</span><span class="o">:</span><span class="n">label</span> <span class="p">]</span>
         <span class="p">)</span> <span class="p">.</span>
</pre></div>


<p>then use code such as:</p>
<div class="codehilite"><pre><span class="n">Dataset</span> <span class="n">ds</span> <span class="o">=</span> <span class="n">DatasetFactory</span><span class="p">.</span><span class="n">assemble</span><span class="p">(</span>
    <span class="s">&quot;text-config.ttl&quot;</span><span class="p">,</span> 
    <span class="s">&quot;http://localhost/jena_example/#text_dataset&quot;</span><span class="p">)</span> <span class="p">;</span>
</pre></div>


<p>Key here is that the assembler contains two dataset definitions, one for
the text dataset, one for the base data.  Therefore, the application
needs to identify the text dataset by it's URI
<code>http://localhost/jena_example/#text_dataset</code>.</p>
<h3 id="configuration-by-code">Configuration by Code</h3>
<p>A text dataset can also be constructed in code as might be done for a
purely in-memory setup:</p>
<div class="codehilite"><pre>    <span class="c1">// Example of building a text dataset with code.</span>
    <span class="c1">// Example is in-memory.</span>
    <span class="c1">// Base dataset</span>
    <span class="n">Dataset</span> <span class="n">ds1</span> <span class="o">=</span> <span class="n">DatasetFactory</span><span class="p">.</span><span class="n">createMem</span><span class="p">()</span> <span class="p">;</span>

    <span class="n">EntityDefinition</span> <span class="n">entDef</span> <span class="o">=</span> <span class="n">new</span> <span class="n">EntityDefinition</span><span class="p">(</span><span class="s">&quot;uri&quot;</span><span class="p">,</span> <span class="s">&quot;text&quot;</span><span class="p">,</span> <span class="n">RDFS</span><span class="p">.</span><span class="n">label</span><span class="p">)</span> <span class="p">;</span>

    <span class="c1">// Lucene, in memory.</span>
    <span class="n">Directory</span> <span class="n">dir</span> <span class="o">=</span>  <span class="n">new</span> <span class="n">RAMDirectory</span><span class="p">();</span>

    <span class="c1">// Join together into a dataset</span>
    <span class="n">Dataset</span> <span class="n">ds</span> <span class="o">=</span> <span class="n">TextDatasetFactory</span><span class="p">.</span><span class="n">createLucene</span><span class="p">(</span><span class="n">ds1</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">entDef</span><span class="p">)</span> <span class="p">;</span>
</pre></div>


<h2 id="working-with-fuseki">Working with Fuseki</h2>
<p>The Fuseki configuration simply points to the text dataset as the
<code>fuseki:dataset</code> of the service.</p>
<div class="codehilite"><pre><span class="o">&lt;</span><span class="err">#</span><span class="n">service_text_tdb</span><span class="o">&gt;</span> <span class="n">rdf</span><span class="o">:</span><span class="n">type</span> <span class="n">fuseki</span><span class="o">:</span><span class="n">Service</span> <span class="p">;</span>
    <span class="nl">rdfs:</span><span class="n">label</span>                      <span class="s">&quot;TDB/text service&quot;</span> <span class="p">;</span>
    <span class="nl">fuseki:</span><span class="n">name</span>                     <span class="s">&quot;ds&quot;</span> <span class="p">;</span>
    <span class="nl">fuseki:</span><span class="n">serviceQuery</span>             <span class="s">&quot;query&quot;</span> <span class="p">;</span>
    <span class="nl">fuseki:</span><span class="n">serviceQuery</span>             <span class="s">&quot;sparql&quot;</span> <span class="p">;</span>
    <span class="nl">fuseki:</span><span class="n">serviceUpdate</span>            <span class="s">&quot;update&quot;</span> <span class="p">;</span>
    <span class="nl">fuseki:</span><span class="n">serviceUpload</span>            <span class="s">&quot;upload&quot;</span> <span class="p">;</span>
    <span class="nl">fuseki:</span><span class="n">serviceReadGraphStore</span>    <span class="s">&quot;get&quot;</span> <span class="p">;</span>
    <span class="nl">fuseki:</span><span class="n">serviceReadWriteGraphStore</span>    <span class="s">&quot;data&quot;</span> <span class="p">;</span>
    <span class="nl">fuseki:</span><span class="n">dataset</span>                  <span class="o">:</span><span class="n">text_dataset</span> <span class="p">;</span>
    <span class="p">.</span>
</pre></div>


<h2 id="building-a-text-index">Building a Text Index</h2>
<p>When working at scale, or when preparing a published, read-only, SPARQL
service, creating the index by loading the text dataset is impractical.<br />
The index and the dataset can be built using command line tools in two
steps: first load the RDF data, second create an index from the existing
RDF dataset.</p>
<h3 id="step-1-building-a-tdb-dataset">Step 1 - Building a TDB dataset</h3>
<p><strong>Note:</strong> If you have an existing TDB dataset then you can skip this step</p>
<p>Build the TDB dataset:</p>
<div class="codehilite"><pre><span class="n">java</span> <span class="o">-</span><span class="n">cp</span> <span class="err">$</span><span class="n">FUSEKI_HOME</span><span class="o">/</span><span class="n">fuseki</span><span class="o">-</span><span class="n">server</span><span class="p">.</span><span class="n">jar</span> <span class="n">tdb</span><span class="p">.</span><span class="n">tdbloader</span> <span class="o">--</span><span class="n">tdb</span><span class="o">=</span><span class="n">assembler_file</span> <span class="n">data_file</span>
</pre></div>


<p>using the copy of TDB included with Fuseki.</p>
<p>Alternatively, use one of the
<a href="../tdb/commands.html">TDB utilities</a> <code>tdbloader</code> or <code>tdbloader2</code> which are better for bulk loading:</p>
<div class="codehilite"><pre><span class="err">$</span><span class="n">JENA_HOME</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">tdbloader</span> <span class="o">--</span><span class="n">loc</span><span class="o">=</span><span class="n">directory</span>  <span class="n">data_file</span>
</pre></div>


<h3 id="step-2-build-the-text-index">Step 2 - Build the Text Index</h3>
<p>You can then build the text index with the <code>jena.textindexer</code> tool:</p>
<div class="codehilite"><pre><span class="n">java</span> <span class="o">-</span><span class="n">cp</span> <span class="err">$</span><span class="n">FUSEKI_HOME</span><span class="o">/</span><span class="n">fuseki</span><span class="o">-</span><span class="n">server</span><span class="p">.</span><span class="n">jar</span> <span class="n">jena</span><span class="p">.</span><span class="n">textindexer</span> <span class="o">--</span><span class="n">desc</span><span class="o">=</span><span class="n">assembler_file</span>
</pre></div>


<p>Because a Fuseki assembler description can have several datasets descriptions, 
and several text indexes, it may be necessary to extract a single dataset and index description
into a separate assembler file for use in loading.</p>
<h2 id="deletion-of-indexed-entities">Deletion  of Indexed Entities</h2>
<p>If the text index is being maintain by changed to the RDF, then deletion of
RDF triple or quads does not cause entries in the index to be removed.  The
index does not store the literal indexed, nor does it store a reference
count of how many triples refer to the index so the information to delete
entries is not available. </p>
<p>In situations where this matters, the SPARQL query should look up in the
text index, then check in the RDF data.  Indeed, this may be necessary
anyway because a text search does not necessarily give only exact matches.</p>
<p>In the initial example:</p>
<div class="codehilite"><pre><span class="n">SELECT</span> <span class="o">?</span><span class="n">s</span> <span class="o">?</span><span class="n">label</span>
<span class="p">{</span> <span class="o">?</span><span class="n">s</span> <span class="n">text</span><span class="o">:</span><span class="n">query</span> <span class="p">(</span><span class="n">rdfs</span><span class="o">:</span><span class="n">label</span> <span class="err">&#39;</span><span class="n">word</span><span class="err">&#39;</span> <span class="mi">10</span><span class="p">)</span> <span class="p">;</span> 
     <span class="n">rdfs</span><span class="o">:</span><span class="n">label</span> <span class="o">?</span><span class="n">label</span> 
<span class="p">}</span>
</pre></div>


<p>the SPARQL query is checking that the <code>rdfs:label</code> triple exists, and if it
does, returning the whole label.</p>
<p>By only indexing but not storing the literals themselves, the index is kept smaller.
It may be necessary to periodically rebuild the index if a large proportion
of the RDF data changes.</p>
<h2 id="maven-dependency">Maven Dependency</h2>
<p>The <code>jena-text</code> module is included in Fuseki.  To use it within application code,
then use the following maven dependency:</p>
<div class="codehilite"><pre><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>org.apache.jena<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>jena-text<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>X.Y.Z<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></div>


<p>adjusting the version <code>X.Y.Z</code> as necessary.  This will automatically
include a compatible version of Lucene and the Solr java client, but not Solr server.</p>
  </div>
</div>

</div><!--/.container -->

    <footer class="footer">
      <div class="container">
        <p>Copyright &copy; 2011&ndash;2013 The Apache Software Foundation, Licensed under
        the <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a>.
        </p>
        <p>
        Apache Jena, Jena, the Apache Jena project logo,
        Apache and the Apache feather logos are trademarks of The Apache Software Foundation.
        </p>
      </div>
  </footer>
      

</body>
</html>
