<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<!--

    Licensed to the Apache Software Foundation (ASF) under one or more
    contributor license agreements.  See the NOTICE file distributed with
    this work for additional information regarding copyright ownership.
    The ASF licenses this file to You under the Apache License, Version 2.0
    (the "License"); you may not use this file except in compliance with
    the License.  You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE- 2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
-->

  <link href="/jena-doc/css/bootstrap.min.css" rel="stylesheet" type="text/css">
  <link href="/jena-doc/css/bootstrap-extension.css" rel="stylesheet" type="text/css">

  <title>Apache Jena - Event handling in Jena</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>
  <script src="/jena-doc/js/jena-navigation.js" type="text/javascript"></script>
  <script src="/jena-doc/js/bootstrap.min.js" type="text/javascript"></script>
</head>

<body>
    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
        <a class="brand" href="/jena-doc/index.html" style="padding-top: 6px; padding-bottom: 0px;">
            <img class="logo-menu" src="/jena-doc/images/jena-logo/jena-logo-notext-small.png" alt="jena logo">
          </a>
          <a class="brand" href="/jena-doc/index.html">Apache Jena</a>
          <div class="nav-collapse collapse">
            <ul class="nav">
              <li id="homepage"><a href="/jena-doc/index.html"><i class="icon-home"></i> Home</a></li>
              <li id="download"><a href="/jena-doc/download/index.html"><i class="icon-download-alt"></i> Download</a></li>
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="icon-book"></i> Learn <b class="caret"></b></a>
                <ul class="dropdown-menu">
                  <li class="nav-header">Tutorials</li>
                  <li><a href="/jena-doc/tutorials/index.html">Overview</a></li>
                  <li><a href="/jena-doc/tutorials/rdf_api.html">RDF core API tutorial</a></li>
                  <li><a href="/jena-doc/tutorials/sparql.html">SPARQL tutorial</a></li>
                  <li><a href="/jena-doc/documentation/query/manipulating_sparql_using_arq.html">Manipulating SPARQL using ARQ</a></li>
                  <li><a href="/jena-doc/tutorials/using_jena_with_eclipse.html">Using Jena with Eclipse</a></li>
                  <li><a href="/jena-doc/documentation/notes/index.html">How-To's</a></li>
                  <li class="divider"></li>
                  <li class="nav-header">References</li>
                  <li><a href="/jena-doc/documentation/index.html">Overview</a></li>
                  <li><a href="/jena-doc/documentation/javadoc/">Javadoc</a></li>
                  <li><a href="/jena-doc/documentation/rdf/index.html">RDF API</a></li>
                  <li><a href="/jena-doc/documentation/io/">RDF I/O</a></li>
                  <li><a href="/jena-doc/documentation/query/index.html">ARQ (SPARQL)</a></li>
                  <li><a href="/jena-doc/documentation/query/text-query.html">Text Search</a></li>
                  <li><a href="/jena-doc/documentation/tdb/index.html">TDB</a></li>
                  <li><a href="/jena-doc/documentation/sdb/index.html">SDB</a></li>
                  <li><a href="/jena-doc/documentation/serving_data/index.html">Fuseki</a></li>
                  <li><a href="/jena-doc/documentation/assembler/index.html">Assembler</a></li>
                  <li><a href="/jena-doc/documentation/ontology/">Ontology API</a></li>
                  <li><a href="/jena-doc/documentation/inference/index.html">Inference API</a></li>
                  <li><a href="/jena-doc/documentation/tools/index.html">Command-line tools</a></li>
                </ul>
              </li>
              <li id="ask"><a href="/jena-doc/help_and_support/index.html"><i class="icon-question-sign"></i> Ask</a></li>
              
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="icon-bullhorn"></i> Get involved <b class="caret"></b></a>
                <ul class="dropdown-menu">
                  <li><a href="/jena-doc/getting_involved/index.html">Contribute</a></li>
                  <li><a href="/jena-doc/help_and_support/bugs_and_suggestions.html">Report a bug</a></li>
                  <li class="divider"></li>
                  <li class="nav-header">Project</li>
                  <li><a href="/jena-doc/about_jena/about.html">About Jena</a></li>
                  <li><a href="/jena-doc/about_jena/roadmap.html">Roadmap</a></li>
                  <li><a href="/jena-doc/about_jena/architecture.html">Architecture</a></li>
                  <li><a href="/jena-doc/about_jena/team.html">Project team</a></li>
                  <li><a href="/jena-doc/about_jena/contributions.html">Related projects</a></li>
                  <li class="divider"></li>
                  <li class="nav-header">ASF</li>
                  <li><a href="http://www.apache.org/">Apache Software Foundation</a></li>
                  <li><a href="http://www.apache.org/licenses/LICENSE-2.0">License</a></li>
                  <li><a href="http://www.apache.org/foundation/thanks.html">Thanks</a></li>
                  <li><a href="http://www.apache.org/foundation/sponsorship.html">Become a Sponsor</a></li>
                  <li><a href="http://www.apache.org/security/">Security</a></li>
                </ul>
              </li>
            </ul>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>


<div class="container">
	<div class="row-fluid">
	<div class="span12">
	<h1 class="title">Event handling in Jena</h1>
  <h2 id="modelchangedlistener">ModelChangedListener</h2>
<p>In Jena it is possible to monitor a <code>Model</code> for changes, so that
code can be run after changes are applied without the coding for
that Model having to do anything special. We call these changes
"events". This first
design and implementation is open for user comment and we may
refine or reduce the implementation as more experience is gained with
it.</p>
<p>To monitor a Model, you must <em>register</em> a <em>ModelChangedListener</em>
with that Model:</p>
<div class="codehilite"><pre>    <span class="n">Model</span> <span class="n">m</span> <span class="o">=</span> <span class="n">ModelFactory</span><span class="p">.</span><span class="n">createDefaultModel</span><span class="p">();</span>
    <span class="n">ModelChangedListener</span> <span class="n">L</span> <span class="o">=</span> <span class="n">new</span> <span class="n">MyListener</span><span class="p">();</span>
    <span class="n">m</span><span class="p">.</span><span class="k">register</span><span class="p">(</span> <span class="n">L</span> <span class="p">);</span>
</pre></div>


<p><em>MyListener</em> must be an implementation of <em>ModelChangedListener</em>,
for example:</p>
<div class="codehilite"><pre>    <span class="n">class</span> <span class="n">MyListener</span> <span class="n">implements</span> <span class="n">ModelChangedListener</span>
        <span class="p">{</span>
        <span class="n">public</span> <span class="kt">void</span> <span class="n">addedStatement</span><span class="p">(</span> <span class="n">Statement</span> <span class="n">s</span> <span class="p">)</span>
            <span class="p">{</span> <span class="n">System</span><span class="p">.</span><span class="n">out</span><span class="p">.</span><span class="n">println</span><span class="p">(</span> <span class="s">&quot;&gt;&gt; added statement &quot;</span> <span class="o">+</span> <span class="n">s</span> <span class="p">);</span> <span class="p">}</span>
        <span class="n">public</span> <span class="kt">void</span> <span class="n">addedStatements</span><span class="p">(</span> <span class="n">Statement</span> <span class="p">[]</span> <span class="n">statements</span> <span class="p">)</span> <span class="p">{}</span>
        <span class="n">public</span> <span class="kt">void</span> <span class="n">addedStatements</span><span class="p">(</span> <span class="n">List</span> <span class="n">statements</span> <span class="p">)</span> <span class="p">{}</span>
        <span class="n">public</span> <span class="kt">void</span> <span class="n">addedStatements</span><span class="p">(</span> <span class="n">StmtIterator</span> <span class="n">statements</span> <span class="p">)</span> <span class="p">{}</span>
        <span class="n">public</span> <span class="kt">void</span> <span class="n">addedStatements</span><span class="p">(</span> <span class="n">Model</span> <span class="n">m</span> <span class="p">)</span> <span class="p">{}</span>
        <span class="n">public</span> <span class="kt">void</span> <span class="n">removedStatement</span><span class="p">(</span> <span class="n">Statement</span> <span class="n">s</span> <span class="p">)</span> <span class="p">{}</span>
        <span class="n">public</span> <span class="kt">void</span> <span class="n">removedStatements</span><span class="p">(</span> <span class="n">Statement</span> <span class="p">[]</span> <span class="n">statements</span> <span class="p">)</span> <span class="p">{}</span>
        <span class="n">public</span> <span class="kt">void</span> <span class="n">removedStatements</span><span class="p">(</span> <span class="n">List</span> <span class="n">statements</span> <span class="p">)</span> <span class="p">{}</span>
        <span class="n">public</span> <span class="kt">void</span> <span class="n">removedStatements</span><span class="p">(</span> <span class="n">StmtIterator</span> <span class="n">statements</span> <span class="p">)</span> <span class="p">{}</span>
        <span class="n">public</span> <span class="kt">void</span> <span class="n">removedStatements</span><span class="p">(</span> <span class="n">Model</span> <span class="n">m</span> <span class="p">)</span> <span class="p">{}</span>
        <span class="p">}</span>
</pre></div>


<p>This listener ignores everything except the addition of single
statements to <em>m</em>; those it prints out. The listener has a method
for each of the ways that statements can be added to a Model:</p>
<ul>
<li>as a single statement, <code>Model::add(Statement)</code></li>
<li>as an element of an array of statements,
    <code>Model::add(Statement[])</code></li>
<li>as an element of a list of statements, <code>Model::add(List)</code></li>
<li>as an iterator over statements, <code>Model::add(StmtIterator)</code></li>
<li>as part of another Model, <code>Model::add(Model)</code></li>
</ul>
<p>(Similarly for <em>delete</em>.)</p>
<p>The listener method is called when the statement(s) have been added
to the Model, if no exceptions have been thrown. It does not matter
if the statement was <em>already</em> in the Model or not; it is the act
of adding it that fires the listener.</p>
<p>There is no guarantee that the statement, array, list, or model
that is added or removed is the same one that is passed to the
appropriate listener method, and the <em>StmtIterator</em> will never be
the same one. However, in the current design:</p>
<ul>
<li>a single Statement will be .equals to the original Statement</li>
<li>a List will be .equals to the original List</li>
<li>a Statement[] will be the same length and have .equal elements
    in the same order</li>
<li>a StmtIterator will deliver .equal elements in the same order</li>
<li>a Model will contain the same statements</li>
</ul>
<p>We advise not relying on these ordering properties; instead assume
that for any bulk update operation on the model, the listener will
be told the method of update and the statements added or removed,
but that the order may be different and duplicate statements may
have been removed.
Note in particular that a Model with any Listeners will have to
record the complete contents of any <em>StmtIterator</em> that is added or
removed to the model, so that the Model and the Listener can both
see all the statements.</p>
<p>Finally, there is no guarantee that <em>only</em> Statements etc added
through the Model API will be presented to the listener; any
Triples added to its underlying Graph will also be presented to the
listener as statements.</p>
<h2 id="utility-classes">Utility classes</h2>
<p>The full Listener API is rather chunky and it can be inconvenient
to use, especially for the creation of inline classes. There are
four utility classes in <em>com.hp.hpl.jena.rdf.listeners:</em></p>
<ul>
<li><em>NullListener</em>. This class's methods do nothing. This is useful
    when you want to subclass and intercept only specific ways of
    updating a Model.</li>
<li><em>ChangedListener</em>. This class only records whether some change
    has been made, but not what it is. The method <em>hasChanged()</em>
    returns <em>true</em> if some change has been made since the last call of
    <em>hasChanged()</em> [or since the listener was created].</li>
<li><em>StatementListener</em>. This class translates all bulk update
    calls (ie the ones other than <em>addedStatement()</em> and
    <em>removedStatement()</em>) into calls to
    <em>addedStatement()/removedStatement()</em> for each Statement in the
    collection. This allows statements to be tracked whether they are
    added one at a time or in bulk.</li>
<li><em>ObjectListener</em>. This class translates all the listener calls
    into <em>added(Object)</em> or <em>removed(Object)</em> as appropriate; it is
    left to the user code to distinguish among the types of argument.</li>
</ul>
<h2 id="when-listeners-are-called">When listeners are called</h2>
<p>In the current implementation, listener methods are called
immediately the additions or removals are made, in the same thread
as the one making the update. If a model has multiple listeners
registered, the order in which they are informed about an update is
unspecified and may change from update to update. If any listener
throws an exception, that exception is thrown through the update
call, and other listeners may not be informed of the update.
Hence listener code should be brief and exception-free if at all
possible.</p>
<h2 id="registering-and-unregistering">Registering and unregistering</h2>
<p>A listener may be registered with the same model multiple times. If
so, it will be invoked as many times as it is registered for each
update event on the model.</p>
<p>A listener <em>L</em> may be <em>unregistered</em> from a Model using the method
<code>unregister(L)</code>. If <em>L</em> is not registered with the model, nothing
happens.</p>
<p>If a listener is registered multiple times with the same model,
each <code>unregister()</code> for that listener will remove just one of the
registrations.</p>
<h2 id="transactions-and-databases">Transactions and databases</h2>
<p>In the current design, listeners are not informed of transaction
boundaries, and all events are fed to listeners as soon as they
happen.</p>
  </div>
</div>

</div><!--/.container -->

    <footer class="footer">
      <div class="container">
        <p>Copyright &copy; 2011&ndash;2013 The Apache Software Foundation, Licensed under
        the <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a>.
        </p>
        <p>
        Apache Jena, Jena, the Apache Jena project logo,
        Apache and the Apache feather logos are trademarks of The Apache Software Foundation.
        </p>
      </div>
  </footer>
      

</body>
</html>
